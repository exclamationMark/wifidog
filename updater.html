<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>


<div id="wifi" style="padding-bottom: 20px">
    router
    <div>hp: <span class="hp"> -/- </span></div>
    <div>xp: <span class="xp"> -/- </span></div>
</div>

<div id="piggy"  style="padding-bottom: 20px">
    piggybank
    <div>hp: <span class="hp"> -/- </span></div>
    <div>xp: <span class="xp"> -/- </span></div>
</div>

<div id="feed"  style="padding-bottom: 20px" data-id='1'>
    feed the dog
    <div><span class="time"></span></div>
    <div><span class="claim" style="display: none">CLAIM YOUR REWARD</span></div>
</div>

<div id="play"  style="padding-bottom: 20px" data-id='2'>
    play with the dog
    <div><span class="time"></span></div>
    <div><span class="claim" style="display: none">CLAIM YOUR REWARD</span></div>
</div>



<script>
//var url = "http://35.195.75.109:5000/updater";
var url = "dogfile.json";
var characters = {}
characters ['piggy'] = {}
characters ['wifi'] = {}
characters['piggy'].element = document.getElementById('piggy')
characters['wifi'].element = document.getElementById('wifi')
var initialized = 0;


var quests = {}
quests ['Feed the dog'] = {}
quests ['Play with the dog'] = {}
quests ['Feed the dog'].element = document.getElementById('feed')
quests ['Play with the dog'].element = document.getElementById('play')


function loadStatus(dogdata){
     for(i=0; i<dogdata['characters'].length; i++){
        if (dogdata['characters'][i]['icon'] in characters){
            loadedData = dogdata['characters'][i];
            character = characters[loadedData['icon']];
            character.xp = loadedData.xp;
            character.hp = loadedData.hp;
            character.element.getElementsByClassName('hp')[0].innerHTML = loadedData['hp'] + '/' + loadedData['maxhp'];
            character.element.getElementsByClassName('xp')[0].innerHTML = loadedData['xp'] + '/' + loadedData['nextLevel']
        }
     }
     for(i=0; i<dogdata['quests'].length; i++){
        if (dogdata['quests'][i]['task'] in quests){
            loadedData = dogdata['quests'][i];
            quest = quests[loadedData['task']];
            
            quest.status = loadedData['status'];
            if(quest.status == 'completed'){
               quest.element.getElementsByClassName('claim')[0].style.display = 'block';
            }
            if(quest.status == 'claimed'){
                quest.element.style.display = "none";
               //quest.element.getElementsByClassName('claim')[0].style.display = 'block';
            }
            quest.element.getElementsByClassName('time')[0].innerHTML = loadedData['time']
        }
     }
}

function updateStatus(dogdata){
    //characters
    for(i=0; i<dogdata['characters'].length; i++){
        if (dogdata['characters'][i]['icon'] in characters){
            loadedData = dogdata['characters'][i];
            character = characters[loadedData['icon']];
            if(loadedData.hp > character.hp){
                //WE GAINED HP!!!
                character.element.getElementsByClassName('hp')[0].innerHTML = '<b>' + loadedData['hp'] + '</b>/' + loadedData['maxhp'];
            }
            if(loadedData.xp > character.xp){
                //WE GAINED XP!!!
                 character.element.getElementsByClassName('xp')[0].innerHTML = '<b>' + loadedData['xp'] + '</b>/' + loadedData['nextLevel']
            }      
            character.xp = loadedData.xp;
            character.hp = loadedData.hp;
        }
    }

    for(i=0; i<dogdata['quests'].length; i++){
        if (dogdata['quests'][i]['task'] in quests){
            loadedData = dogdata['quests'][i];
            quest = quests[loadedData['task']];
            
            if(quest.status == 'active' && loadedData['status']=='completed'){
                // A QUEST WAS COMPLETED AND AN AWARD IS AVAILABLE
                quest.element.getElementsByClassName('claim')[0].style.display = 'block';
            }

            quest.status = loadedData['status'];
        }
     }
}


function fetchNewData() {
  $.ajax({
    url: url, 
    success: function(data) {
      if(initialized==0){
            loadStatus(data);
            initialized = 1;
        }else{
            updateStatus(data);
        }
    },
    complete: function() {
      setTimeout(fetchNewData, 1000);
    }
  });
}

// schedule the first invocation:
setTimeout(fetchNewData, 1000);

function myFunction(arr) {
    var out = "";
    var i;
    for(i = 0; i < arr.length; i++) {
        out += '<a href="' + arr[i].url + '">' + 
        arr[i].display + '</a><br>';
    }
    document.getElementById("id01").innerHTML = out;
}


//claiming prizes
$('.claim').click(function(){
    console.log("hello console");
    var quest_id = $(this).parent().parent().data('id');
    $(this).hide()
    $.ajax
    ({ 
        url: 'claim',
        data: {"questID": quest_id},
        type: 'get',
        success: function(result)
        {
            //success is not an option!
        }
    });
});
</script>